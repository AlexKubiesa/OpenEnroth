
version: 1.0.{build}
image: Visual Studio 2017
shallow_clone: true

cache:
  - C:\3rd_party

install:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-http-proxy.ps1'))

  # cpplint
  - ps: |
      $CPPLINT2DIR = "C:\3rd_party\styleguide-gh-pages"
      if (!(Test-Path -Path $CPPLINT2DIR)) {
        Start-FileDownload https://github.com/google/styleguide/archive/gh-pages.zip
        7z x gh-pages.zip -aoa -oC:\3rd_party\
      }
      $CPPLINT2DIR = "C:\3rd_party\styleguide-gh-pages\cpplint"
      $env:CPPLINT2DIR = $CPPLINT2DIR

build_script:
  - cmd: cd %APPVEYOR_BUILD_FOLDER%
  - ps: |
      Get-ChildItem "./Arcomage" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Arcomage" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./src" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./src" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./src/Application" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./src/Application" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./IO" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./IO" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Media" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Media" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Media/Audio" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Media/Audio" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Platform" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Platform" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Platform/Win" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Platform/Win" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./GUI" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./GUI" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./GUI/UI" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./GUI/UI" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./GUI/UI/Books" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./GUI/UI/Books" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics/Direct3D" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics/Direct3D" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics/Level" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics/Level" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics/OpenGL" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Graphics/OpenGL" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Objects" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Objects" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Serialization" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Serialization" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Spells" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Spells" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Tables" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/Tables" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/TurnEngine" -Filter *.cpp | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }
      Get-ChildItem "./Engine/TurnEngine" -Filter *.h | Foreach-Object { python $CPPLINT2DIR\cpplint.py $_.FullName ; if($LastExitCode -ne 0) { $host.SetShouldExit($LastExitCode ) } }

  - cmd: msbuild "Build/Visual Studio 2017/World of Might and Magic.sln" /p:configuration=debug
